---
description:
globs:
alwaysApply: false
---
# Crypto Pay API Integration

The bot integrates with Crypto Pay API to allow users to add funds to their balance.

## Implementation Files
- `integrations/crypto_pay_api.py` - Main integration class for Crypto Pay API
- `services/payment_service.py` - Service for processing payments
- `config.py` - Contains API tokens and endpoints

## Key Features

### Invoice Creation
The bot creates invoices for users to add funds using Crypto Pay API:
- Supports multiple cryptocurrencies (USDT, TON, BTC, ETH, etc.)
- Configurable payment amounts
- Webhook for payment confirmation

### Balance Management
- Track user deposits through Crypto Pay transactions
- Update user balance when payments are confirmed
- Support for transaction history

### Webhook Processing
- Receive and verify webhook updates from Crypto Pay API
- Process payment notifications securely
- Update user balance when payments are confirmed

## API Authentication
The integration uses the Crypto Pay API token that must be obtained from @CryptoBot on Telegram:
1. Open @CryptoBot
2. Go to Crypto Pay > Create App
3. Store the API token in configuration

## API Endpoints
The integration uses these key API endpoints:
- `/createInvoice` - Generate payment invoices
- `/getInvoices` - Check invoice status
- `/getBalance` - Check available balance
- `/getExchangeRates` - Get current exchange rates

## Security
- Webhook signature verification
- IP allowlisting for API requests
- Secure token storage
